module.exports=[22734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},46786,(e,t,r)=>{t.exports=e.x("os",()=>require("os"))},33473,e=>{e.v({name:"dotenv",version:"16.6.1",description:"Loads environment variables from .env file",main:"lib/main.js",types:"lib/main.d.ts",exports:{".":{types:"./lib/main.d.ts",require:"./lib/main.js",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},scripts:{"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard",pretest:"npm run lint && npm run dts-check",test:"tap run --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run --show-full-coverage --timeout=60000 --coverage-report=text --coverage-report=lcov",prerelease:"npm test",release:"standard-version"},repository:{type:"git",url:"git://github.com/motdotla/dotenv.git"},homepage:"https://github.com/motdotla/dotenv#readme",funding:"https://dotenvx.com",keywords:["dotenv","env",".env","environment","variables","config","settings"],readmeFilename:"README.md",license:"BSD-2-Clause",devDependencies:{"@types/node":"^18.11.3",decache:"^4.6.2",sinon:"^14.0.1",standard:"^17.0.0","standard-version":"^9.5.0",tap:"^19.2.0",typescript:"^4.8.4"},engines:{node:">=12"},browser:{fs:!1}})},23721,(e,t,r)=>{let n=e.r(22734),o=e.r(14747),a=e.r(46786),s=e.r(54799),i=e.r(33473).version,l=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function c(e){console.log(`[dotenv@${i}][DEBUG] ${e}`)}function p(e){console.log(`[dotenv@${i}] ${e}`)}function u(e){return e&&e.DOTENV_KEY&&e.DOTENV_KEY.length>0?e.DOTENV_KEY:process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0?process.env.DOTENV_KEY:""}function d(e){let t=null;if(e&&e.path&&e.path.length>0)if(Array.isArray(e.path))for(let r of e.path)n.existsSync(r)&&(t=r.endsWith(".vault")?r:`${r}.vault`);else t=e.path.endsWith(".vault")?e.path:`${e.path}.vault`;else t=o.resolve(process.cwd(),".env.vault");return n.existsSync(t)?t:null}function f(e){return"~"===e[0]?o.join(a.homedir(),e.slice(1)):e}let h={configDotenv:function(e){let t,r=o.resolve(process.cwd(),".env"),a="utf8",s=!!(e&&e.debug),i=!e||!("quiet"in e)||e.quiet;e&&e.encoding?a=e.encoding:s&&c("No encoding is specified. UTF-8 is used by default");let l=[r];if(e&&e.path)if(Array.isArray(e.path))for(let t of(l=[],e.path))l.push(f(t));else l=[f(e.path)];let u={};for(let r of l)try{let t=h.parse(n.readFileSync(r,{encoding:a}));h.populate(u,t,e)}catch(e){s&&c(`Failed to load ${r} ${e.message}`),t=e}let d=process.env;if(e&&null!=e.processEnv&&(d=e.processEnv),h.populate(d,u,e),s||!i){let e=Object.keys(u).length,r=[];for(let e of l)try{let t=o.relative(process.cwd(),e);r.push(t)}catch(r){s&&c(`Failed to load ${e} ${r.message}`),t=r}p(`injecting env (${e}) from ${r.join(",")}`)}return t?{parsed:u,error:t}:{parsed:u}},_configVault:function(e){let t=!!(e&&e.debug),r=!e||!("quiet"in e)||e.quiet;(t||!r)&&p("Loading env from encrypted .env.vault");let n=h._parseVault(e),o=process.env;return e&&null!=e.processEnv&&(o=e.processEnv),h.populate(o,n,e),{parsed:n}},_parseVault:function(e){let t,r=d(e=e||{});e.path=r;let n=h.configDotenv(e);if(!n.parsed){let e=Error(`MISSING_DATA: Cannot parse ${r} for an unknown reason`);throw e.code="MISSING_DATA",e}let o=u(e).split(","),a=o.length;for(let e=0;e<a;e++)try{let r=o[e].trim(),a=function(e,t){let r;try{r=new URL(t)}catch(e){if("ERR_INVALID_URL"===e.code){let e=Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw e.code="INVALID_DOTENV_KEY",e}throw e}let n=r.password;if(!n){let e=Error("INVALID_DOTENV_KEY: Missing key part");throw e.code="INVALID_DOTENV_KEY",e}let o=r.searchParams.get("environment");if(!o){let e=Error("INVALID_DOTENV_KEY: Missing environment part");throw e.code="INVALID_DOTENV_KEY",e}let a=`DOTENV_VAULT_${o.toUpperCase()}`,s=e.parsed[a];if(!s){let e=Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${a} in your .env.vault file.`);throw e.code="NOT_FOUND_DOTENV_ENVIRONMENT",e}return{ciphertext:s,key:n}}(n,r);t=h.decrypt(a.ciphertext,a.key);break}catch(t){if(e+1>=a)throw t}return h.parse(t)},config:function(e){if(0===u(e).length)return h.configDotenv(e);let t=d(e);if(!t){var r;return r=`You set DOTENV_KEY but you are missing a .env.vault file at ${t}. Did you forget to build it?`,console.log(`[dotenv@${i}][WARN] ${r}`),h.configDotenv(e)}return h._configVault(e)},decrypt:function(e,t){let r=Buffer.from(t.slice(-64),"hex"),n=Buffer.from(e,"base64"),o=n.subarray(0,12),a=n.subarray(-16);n=n.subarray(12,-16);try{let e=s.createDecipheriv("aes-256-gcm",r,o);return e.setAuthTag(a),`${e.update(n)}${e.final()}`}catch(n){let e=n instanceof RangeError,t="Invalid key length"===n.message,r="Unsupported state or unable to authenticate data"===n.message;if(e||t){let e=Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw e.code="INVALID_DOTENV_KEY",e}if(r){let e=Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw e.code="DECRYPTION_FAILED",e}throw n}},parse:function(e){let t,r={},n=e.toString();for(n=n.replace(/\r\n?/mg,"\n");null!=(t=l.exec(n));){let e=t[1],n=t[2]||"",o=(n=n.trim())[0];n=n.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),'"'===o&&(n=(n=n.replace(/\\n/g,"\n")).replace(/\\r/g,"\r")),r[e]=n}return r},populate:function(e,t,r={}){let n=!!(r&&r.debug),o=!!(r&&r.override);if("object"!=typeof t){let e=Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw e.code="OBJECT_REQUIRED",e}for(let r of Object.keys(t))Object.prototype.hasOwnProperty.call(e,r)?(!0===o&&(e[r]=t[r]),n&&(!0===o?c(`"${r}" is already defined and WAS overwritten`):c(`"${r}" is already defined and was NOT overwritten`))):e[r]=t[r]}};t.exports.configDotenv=h.configDotenv,t.exports._configVault=h._configVault,t.exports._parseVault=h._parseVault,t.exports.config=h.config,t.exports.decrypt=h.decrypt,t.exports.parse=h.parse,t.exports.populate=h.populate,t.exports=h},17744,e=>{"use strict";var t=e.i(3305),r=e.i(35263),n=e.i(3659),o=e.i(5470),a=e.i(58111),s=e.i(25633),i=e.i(968),l=e.i(42875),c=e.i(70247),p=e.i(62187),u=e.i(487),d=e.i(38189),f=e.i(77577),h=e.i(52319),v=e.i(355),g=e.i(48064),E=e.i(93695);e.i(42157);var y=e.i(24736),m=e.i(9922),R=e.i(65754);async function N(e){try{let{amount:t,description:r,userId:n,currency:o="USD"}=await e.json(),a=process.env.authLogin,s=process.env.authSecret,i=process.env.REDIRECT_URL||"localhost:3000/dashboard/billing";if(!a||!s)return console.error("Credentials missing"),m.NextResponse.json({error:"Отсутствуют credentials CrystalPay"},{status:500});if(i.startsWith("http")||(i=`https://${i.replace(/^\/+/,"")}`),t=Number.parseFloat(t),isNaN(t)||t<10)return m.NextResponse.json({error:"Минимальная сумма пополнения: $10.00 USD"},{status:400});if(t=Number(t.toFixed(2)),!n||"string"!=typeof n)return m.NextResponse.json({error:"Отсутствует userId, попробуйте обновить страницу"},{status:400});let l={auth_login:a,auth_secret:s,amount:t,lifetime:60,currency:o,type:"purchase",description:r||"Пополнение баланса через CrystalPay",extra:`userId:${n}`,redirect_url:i};console.log("Payload to CrystalPay:",l);let c=await fetch("https://api.crystalpay.io/v3/invoice/create/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),p=await c.json();if(console.log("CrystalPay response:",p),!c.ok||p.error){let e=p.errors?p.errors.join(", "):p.error||"Ошибка CrystalPay, попробуйте позже.";return console.error("CrystalPay error:",e),m.NextResponse.json({error:e},{status:400})}return await R.prisma.transaction.create({data:{userId:n,amount:Number(p.amount??t),currency:p.currency??o,method:"crystalpay",status:"pending",externalId:String(p.id)}}),m.NextResponse.json({url:p.url,id:p.id,amount:p.amount,currency:p.currency,description:p.description})}catch(e){return console.error("Server error:",e.message),m.NextResponse.json({error:e.message||"Internal server error"},{status:500})}}e.i(23721).default.config({path:process.cwd()+"/app/api/crystalpay/.env.local"}),e.s(["POST",()=>N],13597);var _=e.i(13597);let w=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/crystalpay/route",pathname:"/api/crystalpay",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/Downloads/vds-hub/vds-hub/app/api/crystalpay/route.ts",nextConfigOutput:"",userland:_}),{workAsyncStorage:b,workUnitAsyncStorage:D,serverHooks:x}=w;function T(){return(0,n.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:D})}async function O(e,t,n){w.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let m="/api/crystalpay/route";m=m.replace(/\/index$/,"")||"/";let R=await w.prepare(e,t,{srcPage:m,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:N,params:_,nextConfig:b,parsedUrl:D,isDraftMode:x,prerenderManifest:T,routerServerContext:O,isOnDemandRevalidate:A,revalidateOnlyGenerated:C,resolvedPathname:I,clientReferenceManifest:V,serverActionsManifest:j}=R,S=(0,l.normalizeAppPath)(m),P=!!(T.dynamicRoutes[S]||T.routes[I]),$=async()=>((null==O?void 0:O.render404)?await O.render404(e,t,D,!1):t.end("This page could not be found"),null);if(P&&!x){let e=!!T.routes[I],t=T.dynamicRoutes[S];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await $();throw new E.NoFallbackError}}let k=null;!P||w.isDev||x||(k="/index"===(k=I)?"/":k);let U=!0===w.isDev||!P,K=P&&!U;j&&V&&(0,s.setReferenceManifestsSingleton)({page:m,clientReferenceManifest:V,serverActionsManifest:j,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:j})});let M=e.method||"GET",L=(0,a.getTracer)(),q=L.getActiveScopeSpan(),F={params:_,prerenderManifest:T,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n)=>w.onRequestError(e,t,n,O)},sharedContext:{buildId:N}},Y=new c.NodeNextRequest(e),H=new c.NodeNextResponse(t),B=p.NextRequestAdapter.fromNodeNextRequest(Y,(0,p.signalFromNodeResponse)(t));try{let s=async e=>w.handle(B,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=L.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${M} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${m}`)}),i=!!(0,o.getRequestMeta)(e,"minimalMode"),l=async o=>{var a,l;let c=async({previousCacheEntry:r})=>{try{if(!i&&A&&C&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await s(o);e.fetchMetrics=F.renderOpts.fetchMetrics;let l=F.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let c=F.renderOpts.collectedTags;if(!P)return await (0,f.sendResponse)(Y,H,a,F.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(a.headers);c&&(t[g.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,n=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await w.onRequestError(e,t,{routerKind:"App Router",routePath:m,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:K,isOnDemandRevalidate:A})},O),t}},p=await w.handleResponse({req:e,nextConfig:b,cacheKey:k,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:T,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:C,responseGenerator:c,waitUntil:n.waitUntil,isMinimalMode:i});if(!P)return null;if((null==p||null==(a=p.value)?void 0:a.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(l=p.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",A?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,h.fromNodeOutgoingHttpHeaders)(p.value.headers);return i&&P||u.delete(g.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,v.getCacheControlHeader)(p.cacheControl)),await (0,f.sendResponse)(Y,H,new Response(p.value.body,{headers:u,status:p.value.status||200})),null};q?await l(q):await L.withPropagatedContext(e.headers,()=>L.trace(u.BaseServerSpan.handleRequest,{spanName:`${M} ${m}`,kind:a.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},l))}catch(t){if(t instanceof E.NoFallbackError||await w.onRequestError(e,t,{routerKind:"App Router",routePath:S,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:K,isOnDemandRevalidate:A})}),P)throw t;return await (0,f.sendResponse)(Y,H,new Response(null,{status:500})),null}}e.s(["handler",()=>O,"patchFetch",()=>T,"routeModule",()=>w,"serverHooks",()=>x,"workAsyncStorage",()=>b,"workUnitAsyncStorage",()=>D],17744)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__3d9180f6._.js.map